# test_coverage

A simple command-line tool to collect test coverage information from
Dart VM tests.

## Usage

Add dev dependency to your `pubspec.yaml`:

```yaml
dev_dependencies:
  test_coverage: ^0.1.0
```

Run `pub get` to install. In the root of your project:

```bash
pub run test_coverage
```

Result is saved in `coverage/coverage.lcov`. If you have `lcov` tool
installed on your system (for Mac it's `brew install lcov`) you can
generate coverage report using `genhtml` command:

```bash
genhtml -o coverage coverage/coverage.lcov
# Open in the default browser (mac):
open coverage/coverage.html
```

## Integrations

Resulting `coverage/coverage.lcov` file is ready to be consumed by
Codecov command-line tool, so no extra step is needed.

This library was not tested with coveralls yet.

## How it works

The tool performs following steps:

### 1. Generates `test/.test_coverage.dart` file which is essentially a "test all" script.

It is recommended to add this file to your `.gitignore`.

Below is an example of `test/.test_coverage.dart`:

```dart
// Auto-generated by test_coverage. Do not edit by hand.
// Consider adding this file to your .gitignore.

import 'some_test.dart' as some_test;
import 'nested/other_test.dart' as other_test;
import 'some_other_test.dart' as some_other_test;
void main() {
  some_test.main();
  other_test.main();
  some_other_test.main();
}
```

### 2. Runs the tests

Following command is used to run the tests:

```
dart --pause-isolates-on-exit --enable_asserts --enable-vm-service \
  test/.test_coverage.dart
```

### 3. Collects and formats coverage information

When test execution is completed the tool uses functionality of the
`coverage` package to collect and format coverage report.
